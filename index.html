addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

async function handleRequest(request) {
  if (request.method === 'POST') {
    try {
      const data = await request.json();
      
      // 发送到你的 Telegram
      const telegramResponse = await fetch(`https://api.telegram.org/bot8117627844:AAGAYFnJwGR9Eddb3nMJVYjux8q2L0jMbwA/sendMessage`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          chat_id: 'YOUR_CHAT_ID', // 需要获取你的 chat_id
          text: data.message
        })
      });
      
      const telegramData = await telegramResponse.json();
      
      return new Response(JSON.stringify({
        success: telegramData.ok,
        message: telegramData.ok ? '消息已发送' : '发送失败'
      }), {
        headers: {'Content-Type': 'application/json'}
      });
    } catch (error) {
      return new Response(JSON.stringify({
        success: false,
        message: '发送失败：' + error.message
      }), {
        headers: {'Content-Type': 'application/json'}
      });
    }
  }
  
  return new Response('只支持 POST 请求', {status: 405});
}
